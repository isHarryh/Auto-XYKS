Auto-XYKS
==========
Auto play Xiaoyuan Kousuan with OCR
使用光学字符识别自动化作答小猿口算  **` v0.2 `**

<sup> This project only supports Chinese docs. If you are an English user, feel free to contact us. </sup>

-----
> **警告：**
> - 本项目仅供代码交流学习和个人娱乐，请勿滥用。


## 介绍 <sub>Intro</sub>
本项目实现了自动化作答小猿口算。

### 实现的功能
1. **题目识别：**
   从屏幕获取小猿口算的应用截图，经过光学字符识别（OCR）处理后，得出对应的题目内容，然后计算答案。
2. **模拟书写答案：**
   通过模拟鼠标的操作，在小猿口算的作答区域书写答案。
3. **提供图形操作界面：**
   - 显示识别的题目内容及答案。
   - 提供退出和暂停程序的按钮。

### 支持的题型
1. **比较大小：**
   支持两个任意位非负整数之间的比较大小。
2. **加减法运算：**
   支持两个任意位非负整数之间的加减法运算。

> **提示：**
> - 目前，万以内数比大小平均每题耗时0.6s，两三位数加减法平均每题耗时1.7s。
> - 绝大部分的作答时间是消耗在书写答案上，书写一个字符约耗时0.25s，而进行一次截图和 OCR 只需要0.06s。

### 下一步计划
1. 通过提前识别下一题来加快作答速度。
2. 提供自定义截图区域的用户界面。
3. 支持乘除法运算。

## 使用方法 <sub>Usage</sub>
1. 在计算机中配置模拟器环境（以便在计算机中运行安卓软件，推荐的模拟器包括 [BlueStacks](https://www.bluestacks.com) 和 [MuMu](https://mumu.163.com)）。
2. 在模拟器中安装小猿口算的安卓安装包（APK）。
3. 下载（或克隆）本仓库的源码到本地。
4. 确保已安装 [Python](https://www.python.org) 3 运行环境，并安装了 opencv-python，pyautogui，keyboard 库（有条件者建议使用 [Poetry](https://python-poetry.org) 依赖管理工具）。
5. 运行 `Main.py` 即可。

> **注意：**
> - 若在运行过程中鼠标脱离控制，请快速地将鼠标移动到屏幕的四角处，以触发程序的自动中断保护机制。

开箱即用的可执行文件考虑在之后版本发布。

## 技术细节 <sub>Details</sub>

### OCR
考虑到软件截图的高可靠和无干扰的特性，以及程序整体的体量控制和性能开销，本程序最终并没有采用基于人工神经网络（NN）的 OCR 技术，而采是用了一种极其原始但十分高效的 OCR 方案，具体如下：

1. 对图像进行预处理，主要是上调图像的对比度。
2. 对图像进行直方图统计，然后进行字符分割，获得若干子图像区域。
3. 对于某个子图像，使用所有可能出现的字符（数字和运算符号等）的模板图片，依次对其进行模板匹配（`cv2.matchTemplate`）。
4. 计算和统计匹配度，匹配度最高的字符模板即为该子图像的识别结果。
5. 完成所有子图像的识别，连接成串。

## 许可证 <sub>Licensing</sub>
本项目基于 **MIT 开源许可证**，详情参见 [License](https://github.com/isHarryh/Auto-USTB-GFJY/blob/main/LICENSE) 页面。
